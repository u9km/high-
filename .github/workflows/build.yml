name: Build UEDumper (Non-Jailbreak)

on:
  workflow_dispatch: # زر التشغيل اليدوي

jobs:
  build:
    runs-on: macos-latest

    steps:
      # 1. تحميل الملفات (بما في ذلك الملف المضغوط)
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. فك الضغط عن الملف (هذه الخطوة كانت ناقصة وتسببت بالمشكلة)
      - name: Unzip Project
        run: |
          echo "Starting Unzip..."
          unzip iOS_UEDumper-main.zip
          echo "Unzip Done. Listing files to confirm folder name:"
          ls -F # لعرض المجلدات الناتجة للتأكد

      # 3. تثبيت Theos (أداة البناء)
      - name: Setup Theos
        uses: actions/checkout@v4
        with:
          repository: theos/theos
          path: theos
          ref: master

      # 4. بناء المشروع (مع الدخول للمجلد الصحيح)
      - name: Build Package
        run: |
          export THEOS=$(pwd)/theos
          
          # ندخل للمجلد الذي نتج عن فك الضغط
          cd iOS_UEDumper-main
          
          # أمر البناء. الخيار FINALPACKAGE=1 مهم لتقليل حجم الملف وتحسين الأداء
          # هذا سينتج ملف DEB
          make package FINALPACKAGE=1

      # 5. رفع الملف الناتج
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: UEDumper-Tweak
          # المسار للملف الناتج داخل المجلد المفكوك
          path: iOS_UEDumper-main/packages/*.deb
